<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Yorimichi — Story</title>
<style>
  :root{
    --fg:#f8fafc;--muted:#cbd5e1;--glass:rgba(0,0,0,.35);
    --bd:rgba(255,255,255,.14);--shadow:0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:#000;color:var(--fg);font-family:system-ui,"Noto Sans JP",sans-serif}
  .bg{position:fixed;inset:0;z-index:-2;background:#000;transition:background 900ms ease}
  .fx{position:fixed;inset:0;z-index:-1;pointer-events:none}
  /* うっすら粒子 */
  .fx::before{
    content:"";position:absolute;inset:0;opacity:.12;
    background-image:radial-gradient(#fff 1px,transparent 1px);
    background-size:2px 2px;mix-blend-mode:overlay;filter:contrast(120%) brightness(120%);
  }
  .wrap{min-height:100%;display:grid;place-items:center;padding:24px}
  .frame{
    width:min(100%,900px);
    background:var(--glass);backdrop-filter:blur(10px);
    border:1px solid var(--bd);border-radius:18px;padding:18px;box-shadow:var(--shadow)
  }
  .top{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-bottom:10px}
  .title{font-weight:800;letter-spacing:.06em;font-size:clamp(18px,2.2vw,22px)}
  .lang{display:flex;gap:8px;align-items:center;background:rgba(255,255,255,.08);border:1px solid var(--bd);border-radius:999px;padding:6px 8px}
  .lang select{appearance:none;background:transparent;border:none;color:var(--fg);font:inherit;padding:2px 4px}
  .sceneHead{display:flex;justify-content:space-between;align-items:end;margin:6px 2px 10px}
  .sceneName{font-weight:700;opacity:.9}
  .sceneIdx{font-variant-numeric:tabular-nums;color:var(--muted)}
  .text{line-height:1.9;font-size:clamp(16px,2.2vw,18px);white-space:pre-wrap}
  .choices{display:flex;flex-wrap:wrap;gap:10px;margin-top:16px}
  button{cursor:pointer;border:none;border-radius:12px;padding:12px 16px;font-weight:700;letter-spacing:.04em;box-shadow:var(--shadow);transition:transform .06s ease}
  button:hover{transform:translateY(-1px)}
  .primary{background:#2563eb;color:#fff}
  .secondary{background:#0ea5e9;color:#fff}
  .ghost{background:transparent;border:1px solid var(--bd);color:#fff}
  .muted{color:var(--muted)}
  .footer{display:flex;justify-content:space-between;align-items:center;margin-top:10px;color:var(--muted);font-size:.9rem}
  @media (prefers-reduced-motion:reduce){
    .bg{transition:none}
    button{transition:none}
  }
</style>
</head>
<body>
<div class="bg" id="bg"></div>
<div class="fx"></div>

<div class="wrap">
  <div class="frame">
    <div class="top">
      <div class="title" id="appTitle">寄り道</div>
      <div class="lang"><span id="langLabel" style="opacity:.8">言語</span>
        <select id="langSelect"><option value="ja">日本語</option><option value="en">English</option></select>
      </div>
    </div>

    <div class="sceneHead">
      <div class="sceneName" id="sceneName"></div>
      <div class="sceneIdx" id="sceneIdx"></div>
    </div>
    <div class="text" id="sceneText"></div>

    <div class="choices" id="choices"></div>

    <div class="footer">
      <div id="tip" class="muted">Enter：次へ / D：寄り道</div>
      <div id="resume" class="muted"></div>
    </div>
  </div>
</div>

<script>
/* ========= 基本設定 ========= */
const LS = {
  lastPage: "who_last_page",
  storyScene: "who_story_scene",
  lang: "who_lang"
};
localStorage.setItem(LS.lastPage, location.pathname.split('/').pop() || 'story.html');

/* ========= i18n ========= */
const I18N = {
  ja:{
    appTitle:"寄り道",
    lang:"言語",
    next:"次へ",
    detour:"寄り道する",
    back:"本道に戻る",
    end:"終わりへ進む",
    resumed:(id)=>`再開中：${id}`
  },
  en:{
    appTitle:"Yorimichi",
    lang:"Language",
    next:"Next",
    detour:"Take a detour",
    back:"Return to path",
    end:"Go to the end",
    resumed:(id)=>`Resumed at: ${id}`
  }
};
const $ = s=>document.querySelector(s);
const bg = $("#bg");

/* ========= グラデ設計 =========
  各テーマは関数で CSS background を返す。画像不要。
*/
const Gradients = {
  dawn: () => `
    radial-gradient(1100px 550px at 50% 8%, rgba(255,210,150,.55), transparent 60%),
    linear-gradient(180deg,#84c5ff 0%,#7ec6e9 28%,#4f86c6 55%,#2b4d73 70%,#162033 100%)`,
  morning: () => `
    radial-gradient(900px 520px at 65% 10%, rgba(255,255,255,.35), transparent 60%),
    linear-gradient(180deg,#c6f1ff 0%,#8ee0ff 30%,#60b8ea 55%,#2e6fa3 100%)`,
  noon: () => `
    linear-gradient(180deg,#9be0ff 0%,#6ec7f1 40%,#3da0d8 70%,#1d3a5b 100%)`,
  shore: () => `
    radial-gradient(800px 160px at 50% 82%, rgba(255,255,255,.35), transparent 60%),
    linear-gradient(180deg,#7dd3fc 0%,#60a5fa 38%,#3b82f6 60%,#1e3a8a 100%)`,
  dusk: () => `
    radial-gradient(1000px 520px at 50% 15%, rgba(255,180,160,.45), transparent 58%),
    linear-gradient(180deg,#ffb4a2 0%,#e07a8a 35%,#7c3a96 65%,#2b1644 100%)`,
  sunset: () => `
    radial-gradient(1200px 540px at 40% 8%, rgba(255,200,120,.55), transparent 60%),
    linear-gradient(180deg,#ffd1a1 0%,#ff8e72 35%,#c45aa1 65%,#351d53 100%)`,
  night: () => `
    radial-gradient(700px 420px at 70% 15%, rgba(255,255,255,.18), transparent 55%),
    linear-gradient(180deg,#0b1020 0%,#101830 45%,#0a1226 100%)`,
  moon: () => `
    radial-gradient(260px 260px at 78% 12%, rgba(255,255,220,.7), rgba(255,255,220,.05) 60%, transparent 61%),
    linear-gradient(180deg,#0d1224 0%,#0f1a34 50%,#09101e 100%)`,
  rain: () => `
    linear-gradient(180deg,rgba(180,210,230,.6) 0%,rgba(120,150,170,.5) 40%,rgba(40,60,80,.75) 100%),
    repeating-linear-gradient(120deg, rgba(255,255,255,.10) 0 2px, transparent 2px 6px)`,
  aurora: () => `
    radial-gradient(1000px 600px at 30% 10%, rgba(120,255,200,.25), transparent 60%),
    radial-gradient(900px 500px at 70% 20%, rgba(120,180,255,.22), transparent 60%),
    linear-gradient(180deg,#051125 0%,#0a1a36 60%,#040a18 100%)`
};

/* ========= 物語データ =========
  s1〜s10 が本道。d1〜d5 が寄り道（各奇数シーンから分岐）。
  detourから戻ると、対応する次の本道へ進む。
*/
const SCENES = {
  s1:{ theme:"dawn",
      name:{ja:"はじまりの波",en:"Waves at the Start"},
      text:{ja:"朝の海。あなたは深呼吸をして、一歩目の音を聞く。",
            en:"Morning sea. You breathe in and hear the sound of the very first step."},
      next:"s2", detour:"d1"},
  d1:{ theme:"shore",
      name:{ja:"寄り道①—砂に描いた地図",en:"Detour 1 — A Map on Sand"},
      text:{ja:"指で線を引くと、子どもの頃の道筋が浮かぶ。どこから来て、どこへ向かう？",
            en:"You draw a line on the sand. A childhood route appears. Where did you come from, where to now?"},
      returnTo:"s2"},
  s2:{ theme:"morning",
      name:{ja:"薄光の問い",en:"Question in Pale Light"},
      text:{ja:"海面に映る自分は、少しだけ他人に見える。", en:"Your reflection looks a little like someone else."},
      next:"s3"},
  s3:{ theme:"noon",
      name:{ja:"真昼の沈黙",en:"Noon Silence"},
      text:{ja:"言葉の代わりに、影が短くなる。", en:"Instead of words, shadows grow short."},
      next:"s4", detour:"d2"},
  d2:{ theme:"rain",
      name:{ja:"寄り道②—通り雨の下で",en:"Detour 2 — Under a Passing Shower"},
      text:{ja:"濡れることを恐れなければ、足取りは軽くなる。", en:"If you don't fear getting wet, your steps lighten."},
      returnTo:"s4"},
  s4:{ theme:"shore",
      name:{ja:"遠浅の記憶",en:"Shallow Memories"},
      text:{ja:"ひたひた、と繰り返しが拍を刻む。", en:"Lapping waves mark the beat of repetition."},
      next:"s5"},
  s5:{ theme:"dusk",
      name:{ja:"夕凪の視線",en:"Gaze of the Dusk Calm"},
      text:{ja:"今日のあなたは、どんな色だった？", en:"What color were you today?"},
      next:"s6", detour:"d3"},
  d3:{ theme:"aurora",
      name:{ja:"寄り道③—空の糸",en:"Detour 3 — Threads in the Sky"},
      text:{ja:"目に見えない糸が、まだ見ぬ選択肢を揺らす。", en:"Invisible threads shake unseen choices."},
      returnTo:"s6"},
  s6:{ theme:"sunset",
      name:{ja:"残照の約束",en:"Afterglow Promise"},
      text:{ja:"約束は声よりも、体温で覚えている。", en:"You remember promises more by warmth than words."},
      next:"s7"},
  s7:{ theme:"night",
      name:{ja:"群青の間",en:"Room of Ultramarine"},
      text:{ja:"暗さは恐れではなく、余白だ。", en:"Darkness is not fear, but margin."},
      next:"s8", detour:"d4"},
  d4:{ theme:"moon",
      name:{ja:"寄り道④—月の読書",en:"Detour 4 — Reading by the Moon"},
      text:{ja:"ページをめくるたび、過去形のあなたが小さく手を振る。", en:"Each page turns; your past self waves quietly."},
      returnTo:"s8"},
  s8:{ theme:"noon",
      name:{ja:"静かな合流",en:"Quiet Confluence"},
      text:{ja:"別れた道が、何事もなかったように並ぶ。", en:"Split paths line up as if nothing happened."},
      next:"s9"},
  s9:{ theme:"dusk",
      name:{ja:"寄せては返す想い",en:"Feelings that Ebb and Flow"},
      text:{ja:"たどり着けなかった答えは、今日の余韻になった。", en:"Answers you missed become today's aftertaste."},
      next:"s10", detour:"d5"},
  d5:{ theme:"rain",
      name:{ja:"寄り道⑤—雨上がりの匂い",en:"Detour 5 — Scent after Rain"},
      text:{ja:"深呼吸。まだ続きがある。", en:"Deep breath. There is still more."},
      returnTo:"s10"},
  s10:{ theme:"dawn",
      name:{ja:"明日の入口",en:"Door to Tomorrow"},
      text:{ja:"ここで終えることも、もう一周することもできる。", en:"You can end here—or go for another round."},
      next:null
  }
};

/* ========= 状態 ========= */
let current = localStorage.getItem(LS.storyScene) || "s1";
let lang = localStorage.getItem(LS.lang) || ((navigator.language||'ja').startsWith('ja')?'ja':'en');
$("#langSelect").value = lang;

/* ========= 画面描画 ========= */
function setGradient(themeKey){
  const make = Gradients[themeKey] || Gradients.noon;
  bg.style.background = make();
}
function t(key){ return I18N[lang][key]; }
function setLang(newLang){
  lang = newLang; localStorage.setItem(LS.lang, lang);
  $("#appTitle").textContent = t("appTitle");
  $("#langLabel").textContent = t("lang");
  render();
}
function render(){
  const sc = SCENES[current];
  if(!sc) return;
  localStorage.setItem(LS.storyScene, current);

  setGradient(sc.theme);
  $("#sceneName").textContent = sc.name[lang];
  $("#sceneText").textContent  = sc.text[lang];

  // index表示
  const idx = Object.keys(SCENES).filter(id=>id.startsWith('s')).indexOf(current)+1;
  $("#sceneIdx").textContent = current.startsWith('s') ? `Scene ${String(idx).padStart(2,'0')}/10` : "Detour";

  // 選択肢
  const box = $("#choices"); box.innerHTML="";
  if(sc.detour){
    const btnD = document.createElement("button");
    btnD.className="secondary"; btnD.textContent=t("detour");
    btnD.onclick=()=>{ current=sc.detour; render(); };
    box.appendChild(btnD);
  }
  if(sc.next){
    const btnN = document.createElement("button");
    btnN.className="primary"; btnN.textContent= current==="s10" ? t("end") : t("next");
    btnN.onclick=()=>{ current=sc.next; render(); };
    box.appendChild(btnN);
  }
  if(sc.returnTo){
    const btnB = document.createElement("button");
    btnB.className="ghost"; btnB.textContent=t("back");
    btnB.onclick=()=>{ current=sc.returnTo; render(); };
    box.appendChild(btnB);
  }

  // 再開表示
  $("#resume").textContent = I18N[lang].resumed(current);
}

/* ========= 入力 ========= */
window.addEventListener("keydown",(e)=>{
  const sc = SCENES[current];
  if(e.key==="Enter" && sc && sc.next){ current=sc.next; render(); }
  if((e.key==="d"||e.key==="D") && sc && sc.detour){ current=sc.detour; render(); }
});

/* ========= 初期化 ========= */
$("#langSelect").addEventListener("change",e=>setLang(e.target.value));
$("#appTitle").textContent = t("appTitle");
$("#langLabel").textContent = t("lang");
render();
</script>
</body>
</html>
